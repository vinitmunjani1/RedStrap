{% extends 'core/base.html' %}

{% block title %}Dashboard - REDSTRAP{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-house"></i> Dashboard</h1>
    <a href="{% url 'add_instagram' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Add Instagram Account
    </a>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-instagram"></i> Instagram Accounts</h5>
                {% if accounts %}
                    <ul class="list-group list-group-flush">
                        {% for account in accounts %}
                            <li class="list-group-item d-flex justify-content-between">
                                <span><strong>@{{ account.username }}</strong></span>
                                <a href="{% url 'account_analytics' account.id %}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-graph-up"></i>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">No Instagram accounts added yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-lightning"></i> Quick Actions</h5>
                <div class="d-flex gap-2 flex-wrap">
                    <form method="post" action="{% url 'scrape_instagram' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-download"></i> Fetch Posts
                        </button>
                    </form>
                    <form method="post" action="{% url 'scrape_reels' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-info">
                            <i class="bi bi-play-circle"></i> Fetch Reels
                        </button>
                    </form>
                    <a href="{% url 'analytics' %}" class="btn btn-outline-primary">
                        <i class="bi bi-bar-chart"></i> View Analytics
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<h3 class="mb-3"><i class="bi bi-images"></i> Recent Posts & Reels</h3>
{% if posts %}
    <div class="post-grid">
        {% for post in posts %}
            <div class="card">
                {% if post.image_url %}
                    <img src="{{ post.image_url }}" class="card-img-top" alt="Post image" style="height: 250px; object-fit: cover;">
                {% endif %}
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="card-title mb-0">
                            {% if post.is_reel %}
                                <span class="badge bg-danger"><i class="bi bi-play-fill"></i> Reel</span>
                            {% elif post.is_video %}
                                <span class="badge bg-primary"><i class="bi bi-camera-video"></i> Video</span>
                            {% else %}
                                <span class="badge bg-secondary"><i class="bi bi-image"></i> Post</span>
                            {% endif %}
                        </h6>
                        <small class="text-muted">{{ post.taken_at|date:"M d" }}</small>
                    </div>
                    <p class="card-text small">{{ post.caption|truncatewords:15|default:"No caption" }}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="small text-muted">
                            <i class="bi bi-heart"></i> {{ post.like_count }}
                            <i class="bi bi-chat ms-2"></i> {{ post.comment_count }}
                            {% if post.is_reel or post.is_video %}
                                <i class="bi bi-play-fill ms-2"></i> {{ post.play_count }}
                            {% endif %}
                        </div>
                        <a href="{% url 'instagram_post_detail' post.id %}" class="btn btn-sm btn-outline-primary">
                            View <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> No posts found. Add an Instagram account and fetch posts to get started.
    </div>
{% endif %}
{% endblock %}

